<div class="row">
    <div class="col">

        <div class="h-100">
            <!-- <div class="row mb-3 pb-1">
                <div class="col-12">
                    <div class="d-flex align-items-lg-center flex-lg-row flex-column">
                        <div class="flex-grow-1">

                        </div>
                        <div class="mt-3 mt-lg-0">
                            <div class="row g-3 mb-0 align-items-center">
                                <div class="col-sm-auto">
                                    <div class="input-group">
                                        <input class="form-control flatpickr-input" type="text" mwlFlatpickr
                                            [dateFormat]="' Y'" [(ngModel)]="currentDate" [altInput]="false"
                                            [convertModelValue]="true" mode="range">
                                        <div class="input-group-text bg-primary border-primary text-white"><i
                                                class="ri-calendar-2-line"></i></div>
                                    </div>
                                </div>
                               
                                <div class="col-auto">
                                    <button type="button" class="btn btn-soft-success shadow-none"
                                        routerLink="/ecommerce/add-product"><i
                                            class="ri-add-circle-line align-middle me-1"></i> Add Product</button>
                                </div>
                                
                                <div class="col-auto">
                                    <button type="button"
                                        class="btn btn-soft-info btn-icon waves-effect waves-light layout-rightside-btn shadow-none"
                                        (click)="toggleActivity()"><i class="ri-pulse-line"></i></button>
                                </div>
                              
                            </div>
                          
                        </div>
                    </div>
                </div>
             
            </div> -->
            <!--end row-->
            <div class="row mb-3 pb-1">
                <div class="col-12">
                    <div class="d-flex align-items-lg-center flex-lg-row flex-column">
                        <div class="flex-grow-1">
                            <h4 class="fs-16 mb-1">
                                Bonjour, {{currentUser.nom}} {{currentUser.prenom}}!
                            </h4>
                            <p class="text-muted mb-0"> Voici un aperçu de l'activité actuelle de votre société de
                                logistique et de transport.</p>
                        </div>
                        <div class="mt-3 mt-lg-0">
                            <div class="row g-3 mb-0 align-items-center">
                                <div class="col-sm-auto">
                                    <div class="input-group">
                                        <input class="form-control flatpickr-input" type="text" mwlFlatpickr
                                            [dateFormat]="'d M, Y'" [(ngModel)]="currentDate" [altInput]="false"
                                            [convertModelValue]="true" mode="single">
                                        <div class="input-group-text bg-primary border-primary text-white">
                                            <i class="ri-calendar-2-line"></i>
                                        </div>
                                    </div>
                                    
                                </div>
                                <!--end col-->
                                <div class="col-auto">
                                    <button type="button" class="btn btn-soft-success shadow-none"
                                        routerLink="/bon/create"><i
                                            class="ri-add-circle-line align-middle me-1"></i> Ajouter Bon livraison </button>
                                </div>
                                <!--end col-->
                                <div class="col-auto">
                                    <button type="button"
                                        class="btn btn-soft-info btn-icon waves-effect waves-light layout-rightside-btn shadow-none"
                                        (click)="toggleActivity()"><i class="ri-pulse-line"></i></button>
                                </div>
                                <!--end col-->
                            </div>
                            <!--end row-->
                        </div>
                    </div><!-- end card header -->
                </div>
                <!--end col-->
            </div>

            <div class="row">
                @for(stat of statusData;track $index){
                <div class="col-xl-3 col-md-6">
                    <app-stat [title]="stat.title" [value]="stat.value" [icon]="stat.icon"
                        [persantage]="stat.persantage" [profit]="stat.profit" [icon_bg_color]="stat.icon_bg_color"
                        [link]="stat.link"   [route]="stat.route"  ></app-stat>
                </div>
                }
            </div> <!-- end row-->

            <div class="row">
                <div class="col-xl-8">
                    <div class="card">
                        <div class="card-header border-0 align-items-center d-flex">
                            <h4 class="card-title mb-0 flex-grow-1">Évolution Mensuelle des Frais et Contre-Remboursements</h4>
                            <div class="d-flex gap-1">
                                <!-- <select class="form-select mb-3" aria-label=".form-select-lg example">
                                    <option selected (change)=""  >Open this select menu</option>
                                    <option value="'all'">One</option>
                                    <option value="2">Two</option>
                                    <option value="3">Three</option>
                                </select> -->
                                <!-- <input class="form-control flatpickr-input" type="text" mwlFlatpickr
                                    [(ngModel)]="selectedYear" (change)="getLivraisonParYearEtMois()" [altInput]="true"
                                    [convertModelValue]="true" altFormat="Y" dateFormat="Y" /> -->

                                    <div class="mb-3" style="width: 100px;">
                                       
                                        <ng-select [items]="listeYear" bindLabel="year" bindValue="year" [(ngModel)]="year"  (change)="getLivraisonParYearEtMois()">
                                          <ng-template ng-optgroup-tmp let-item="item">
                                              {{item.country || 'N/A'}}
                                          </ng-template>
                                        </ng-select>
                                    </div>
                                    <!-- <button type="button btn-success" (click)="test1()" >test</button> -->
                                <!-- <button type="button btn-success" (click)="setrevenuevalue()" >test</button> -->
                                <!-- <button (click)="test() " >test</button>
                                <button type="button" class="btn btn-soft-secondary btn-sm shadow-none" (click)="setrevenuevalue('all')">
                                    ALL
                                </button>
                                <button type="button" class="btn btn-soft-secondary btn-sm shadow-none" (click)="setrevenuevalue('1M')">
                                    1M
                                </button>
                                <button type="button" class="btn btn-soft-secondary btn-sm shadow-none" (click)="setrevenuevalue('6M')">
                                    6M
                                </button>
                                <button type="button" class="btn btn-soft-primary btn-sm shadow-none" (click)="setrevenuevalue('1Y')">
                                    1Y
                                </button> -->
                            </div>
                        </div><!-- end card header -->

                        <div class="card-header p-0 border-0 bg-light-subtle">
                            <div class="row g-0 text-center">
                                <div class="col-6 col-sm-4">
                                    <div class="p-3 border border-dashed border-start-0">
                                        <h5 class="mb-1"><span [countUp]="static?.countLivraisonStatut2?.count" class="counter-value"
                                               ></span></h5>
                                        <p class="text-muted mb-0">Nombre Livraison Terminé</p>
                                    </div>
                                </div>
                                <!--end col-->
                                <div class="col-6 col-sm-4">
                                    <div class="p-3 border border-dashed border-start-0">
                                        <h5 class="mb-1"><span [countUp]="static?.totalFraisLivraisonStatut2?.totalFrais " class="counter-value"
                                                [options]="option"></span> Dinars</h5>
                                        <p class="text-muted mb-0">Total Frais Livraison</p>
                                    </div>
                                </div>
                                <!--end col-->
                                <div class="col-6 col-sm-4">
                                    <div class="p-3 border border-dashed border-start-0">
                                        <h5 class="mb-1"><span [countUp]="static?.totalCrLivraisonStatut2?.totalCr" class="counter-value"
                                                [options]="option"></span> Dinars</h5>
                                        <p class="text-muted mb-0">Total Contre-Remboursement</p>
                                    </div> 
                                </div>

                            </div>
                        </div><!-- end card header -->

                        <div class="card-body p-0 pb-2">
                            <div class="w-100">
                                <apx-chart  *ngIf="analyticsChart.series" dir="ltr" class="apex-charts" [chart]="analyticsChart.chart"
                                    [series]="analyticsChart.series" [legend]="analyticsChart.legend"
                                    [stroke]="analyticsChart.stroke" [colors]="analyticsChart.colors"
                                    [fill]="analyticsChart.fill" [dataLabels]="analyticsChart.dataLabels"
                                    [xaxis]="analyticsChart.xaxis" [markers]="analyticsChart.markers"
                                    [plotOptions]="analyticsChart.plotOptions" [yaxis]="analyticsChart.yaxis"
                                    [tooltip]="analyticsChart.tooltip" [grid]="analyticsChart.grid"
                                    [labels]="analyticsChart.labels" dir="ltr">
                                </apx-chart>
                            </div>
                        </div><!-- end card body -->
                    </div><!-- end card -->
                </div><!-- end col -->
                <div class="col-xl-4">
                    <div class="card card-height-100">
                        <div class="card-header align-items-center d-flex">
                            <h4 class="card-title mb-0 flex-grow-1">Livraisons par État</h4>
                            <div class="flex-shrink-0">
                                <div class="dropdown card-header-dropdown" ngbDropdown>
                                    <a class="text-reset dropdown-btn arrow-none" href="javascript:void(0);"
                                        data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
                                        ngbDropdownToggle>
                                        <span class="text-muted"><i class="mdi mdi-chevron-down ms-1"></i></span>
                                    </a>
                                    <div class="dropdown-menu dropdown-menu-end" ngbDropdownMenu>
                                        <a class="dropdown-item" href="javascript:void(0);">Download Report</a>
                                        <a class="dropdown-item" href="javascript:void(0);">Export</a>
                                        <a class="dropdown-item" href="javascript:void(0);">Import</a>
                                    </div>
                                </div>
                            </div>
                        </div><!-- end card header -->

                        <div class="card-body">
                            <apx-chart class="apex-charts" dir="ltr" [series]="SalesCategoryChart.series"
                                [labels]="SalesCategoryChart.labels" [chart]="SalesCategoryChart.chart"
                                [legend]="SalesCategoryChart.legend" [stroke]="SalesCategoryChart.stroke"
                                [dataLabels]="SalesCategoryChart.dataLabels" [colors]="SalesCategoryChart.colors"
                                dir="ltr"></apx-chart>
                        </div>
                    </div> <!-- .card-->
                </div> <!-- .col-->


                <!-- end col -->
            </div>

           
            <div class="row">
                <div class="col-xl-8">
                    <div class="card">
                        <div class="card-header border-0 align-items-center d-flex">
                            <h4 class="card-title mb-0 flex-grow-1">Nombre livraison par mois</h4>
                            <div class="d-flex gap-1">
                                <!-- <select class="form-select mb-3" aria-label=".form-select-lg example">
                                    <option selected (change)=""  >Open this select menu</option>
                                    <option value="'all'">One</option>
                                    <option value="2">Two</option>
                                    <option value="3">Three</option>
                                </select> -->
                                <!-- <input class="form-control flatpickr-input" type="text" mwlFlatpickr
                                    [(ngModel)]="selectedYear" (change)="getLivraisonParYearEtMois()" [altInput]="true"
                                    [convertModelValue]="true" altFormat="Y" dateFormat="Y" /> -->

                                    <div class="mb-3" style="width: 100px;">
                                       
                                        <ng-select [items]="listeYear" bindLabel="year" bindValue="year" [(ngModel)]="year"  (change)="getLivraisonParYearEtMois()">
                                          <ng-template ng-optgroup-tmp let-item="item">
                                              {{item.country || 'N/A'}}
                                          </ng-template>
                                        </ng-select>
                                    </div>
                                    <!-- <button type="button btn-success" (click)="test()" >test</button> -->
                                <!-- <button type="button btn-success" (click)="setrevenuevalue()" >test</button> -->
                                <!-- <button (click)="test() " >test</button>
                                <button type="button" class="btn btn-soft-secondary btn-sm shadow-none" (click)="setrevenuevalue('all')">
                                    ALL
                                </button>
                                <button type="button" class="btn btn-soft-secondary btn-sm shadow-none" (click)="setrevenuevalue('1M')">
                                    1M
                                </button>
                                <button type="button" class="btn btn-soft-secondary btn-sm shadow-none" (click)="setrevenuevalue('6M')">
                                    6M
                                </button>
                                <button type="button" class="btn btn-soft-primary btn-sm shadow-none" (click)="setrevenuevalue('1Y')">
                                    1Y
                                </button> -->
                            </div>
                        </div><!-- end card header -->


                        <div class="card-body p-0 pb-2">
                            <div class="w-100">
                                <apx-chart   *ngIf="analyticsChartN.series" dir="ltr" class="apex-charts" [chart]="analyticsChartN.chart"
                                    [series]="analyticsChartN.series" [legend]="analyticsChartN.legend"
                                    [stroke]="analyticsChartN.stroke" [colors]="analyticsChartN.colors"
                                    [fill]="analyticsChartN.fill" [dataLabels]="analyticsChartN.dataLabels"
                                    [xaxis]="analyticsChartN.xaxis" [markers]="analyticsChartN.markers"
                                    [plotOptions]="analyticsChartN.plotOptions" [yaxis]="analyticsChartN.yaxis"
                                    [tooltip]="analyticsChartN.tooltip" [grid]="analyticsChartN.grid"
                                    [labels]="analyticsChartN.labels" dir="ltr">
                                </apx-chart>
                            </div>
                        </div><!-- end card body -->
                    </div><!-- end card -->
                </div>
                
            <div class="col-xl-4">
                <div class="card card-height-100">
                    <div class="card-header align-items-center d-flex">
                        <h4 class="card-title mb-0 flex-grow-1">Livraison par Siège</h4>
                        <div class="d-flex gap-1">
                            <!-- <button type="button" class="btn btn-soft-secondary btn-sm shadow-none">
                                ALL
                            </button>
                            <button type="button" class="btn btn-soft-primary btn-sm shadow-none">
                                1M
                            </button>
                            <button type="button" class="btn btn-soft-secondary btn-sm shadow-none" >
                                6M
                            </button> -->
                        </div>
                    </div>
                    <div class="card-body p-0">
                        <div>
                            <apx-chart [series]="salesForecastChart.series" [chart]="salesForecastChart.chart"
                            [colors]="salesForecastChart.colors" [dataLabels]="salesForecastChart.dataLabels"
                            [plotOptions]="salesForecastChart.plotOptions" [yaxis]="salesForecastChart.yaxis"
                            [legend]="salesForecastChart.legend" [fill]="salesForecastChart.fill"
                            [stroke]="salesForecastChart.stroke" [tooltip]="salesForecastChart.tooltip"
                            [xaxis]="salesForecastChart.xaxis" dir="ltr"></apx-chart>
                        </div>
                    </div><!-- end card body -->
                </div><!-- end card  (click)="selectvalue('6M')"-->
            </div> 
            </div> <!-- end row-->
            <div class="row">
                <div class="col-xl-12">
                    <div class="card">
                        <div class="card-header align-items-center d-flex">
                            <h4 class="card-title mb-0 flex-grow-1">Historique Livraison </h4>
                            <div class="flex-shrink-0">
                             
                            </div>
                        </div><!-- end card header -->
                        
                        <div class="card-body">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="card" id="invoiceList">
                                      
                                        <div class="card-body  border border-dashed border-start-0 border-end-0">
                                            <div class="row g-3">
                                                <div class="col-xxl-5 col-sm-12">
                                                    <div class="search-box">
                                                        <input type="text" name="searchTerm" class="form-control search bg-light border-light"
                                                            placeholder="Rechercher BL, expideteur,destinataire, agent..." [(ngModel)]="searchTerm"
                                                            (ngModelChange)="performSearch()">
                                                        <i class="ri-search-line search-icon"></i>
                                                    </div>
                                                </div>
                                                <div class="col-xxl-2 col-sm-12">
                                                    <div>
                                                        <input class="form-control flatpickr-input" type="text" mwlFlatpickr [altInput]="true"
                                                            style="width: 400px !important;" [convertModelValue]="true" placeholder="Select date"
                                                            id="isDate" mode="range" [(ngModel)]="date" (ngModelChange)="onDateChange()">
                                                    </div>
                                                </div>
                                                <div class="col-xxl-2 col-sm-12">
                                                    <div>
                                                        <select class="form-select mb-3" aria-label="Default select example" id="pageSizeSelect"
                                                            [(ngModel)]="service.pageSize" (change)="changePage()">
                                                            <option value="5">5</option>
                                                            <option value="10">10</option>
                                                            <option value="20">20</option>
                                                            <option value="50">50</option>
                                                            <option value="100">100</option>
                                                        </select>
                            
                                                    </div>
                                                </div>
                            
                            
                                            </div>
                                            <!--end row-->
                                        </div>
                                        <div class="card-body">
                                            <div>
                            
                            
                                                <div class="table-responsive table-card">
                                                    <table class="table align-middle table-nowrap  table-hover table-nowrap"
                                                        id="invoiceTable">
                                                        <thead class="text-muted">
                                                            <tr>
                            
                                                                <th class="sort" (click)="onSort('reference')">N°BL</th>
                                                                <th class="sort" (click)="onSort('dateCreation')">Date Liv </th>
                                                                <th class="sort" (click)="onSort('utilisateur.prenom')">Agent Rammassage</th>
                                                                
                                                                <th class="sort" (click)="onSort('totalCR')">CR
                                                                </th>
                                                                <th class="sort" (click)="onSort('totalfrais')">Frais livraison
                                                                </th>
                                                                <th class="sort" (click)="onSort('quantite')">Quantite
                                                                </th>
                                                                <th class="sort" (click)="onSort('statut')">statut
                                                                </th>
                                                               
                                                                <th class="sort" (click)="onSort('expediteur')">Expéditeur
                                                                </th>
                                                                <th class="sort" (click)="onSort('adresseExpediteur')"> Adr Expéditeur</th>
                                                                <th class="sort" (click)="onSort('Destinataire')">Destinataire
                                                                </th>
                                                                <th class="sort" (click)="onSort('adresseDestinataire')">Adr Destinataire </th>
                                                                
                                                                <th>Action</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody class="list form-check-all" id="invoice-list-data">
                                                            @for(data of bons;track $index){
                                                            <tr id="i_{{data.id}}">
                            
                                                                <td><a [routerLink]="['/bon/bondetails', data.id]">
                                                                        <ngb-highlight [result]="data.reference" [term]="searchTerm">
                                                                        </ngb-highlight>
                                                                    </a>
                                                                </td>
                                                                <td><a [routerLink]="['/bon/bondetails', data.id]">
                                                                        <ngb-highlight [result]="(data.dateLivraison | date: 'yyyy-MM-dd')  ??'N/A'"
                                                                            [term]="searchTerm">
                                                                        </ngb-highlight>
                                                                    </a></td>
                                                                
                                                                <td class="customer_name">
                                                                    <ngb-highlight
                                                                        [result]="data?.ChauffeurRamssageNom ?? data?.utilisateurRamassageNom  ?? 'N/A' "
                                                                        [term]="searchTerm">
                                                                    </ngb-highlight>
                                                                </td>
                                                                <td>
                                                                    <ng-container *ngIf="data?.totalCR > 0; else noData">
                                                                        <ngb-highlight [result]="data.totalCR | number:'1.3-3'" [term]="searchTerm" 
                                                                                        class="text-end text-danger">
                                                                        </ngb-highlight>
                                                                      </ng-container>
                                                                      <ng-template #noData>
                                                                        <span class="text-end text-muted"></span>
                                                                      </ng-template>
                                                                </td>
                                                                <td>
                                                                    <ngb-highlight [result]="data?.totalfrais | number:'1.3-3'" [term]="searchTerm"
                                                                        class="text-end">
                                                                    </ngb-highlight>
                                                                </td>
                                                                <td>
                                                                    <ngb-highlight [result]="data?.quantite ?? 'N/A' " [term]="searchTerm"
                                                                        class="text-end">
                                                                    </ngb-highlight>
                                                                </td>
                                                                <td class="statut" id="lj_{{data?.statut}}">
                                                                    <span [ngClass]="getBadgeClasses(data.statut)">
                                                                            {{ getStatusText(data.statut) }}
                                                                        </span>
                            
                            
                            
                                                                </td>
                            
                                                                <td>
                                                                    <ngb-highlight [result]="data?.expediteur ?? 'N/A'" [term]="searchTerm">
                                                                    </ngb-highlight>
                                                                </td>
                                                                <td>
                                                                    <ngb-highlight [result]="data?.adresseExpediteur ?? 'N/A' " [term]="searchTerm">
                                                                    </ngb-highlight>
                                                                </td>
                                                                <td>
                                                                    <ngb-highlight [result]="data?.Destinataire?? 'N/A' " [term]="searchTerm">
                                                                    </ngb-highlight>
                                                                </td>
                                                                <td>
                                                                    <ngb-highlight [result]="data?.adresseDestinataire  ?? 'N/A'"
                                                                        [term]="searchTerm">
                                                                    </ngb-highlight>
                                                                </td>
                                                               
                            
                                                              


                                                                <td  class="centertd">
                                                                    <div class="d-flex gap-2 centertd">
                                                                        <div class="view">
                                                                            
                                                                            <a href="javascript:void(0);" class="link-warning fs-15"   [routerLink]="['/bon/bondetails', data.id]">
                                                                                <i class="ri-eye-fill"></i>
                                                                              </a>
                                                                            </div>
                                                                        <div class="edit">
                                                                            
                                                                            <a href="javascript:void(0);" class="link-success fs-15"   [routerLink]="['/bon/modifier', data.id]">
                                                                                <i class="ri-edit-2-line"></i>
                                                                              </a>
                                                                            </div>
                                                                        
                                                                        <div class="remove">
                                                                            
                                                                            <a href="javascript:void(0);" class="link-info fs-15" [routerLink]="['/bon/status', data.id]">
                                                                                <i class="ri-download-2-line"></i>
                                                                              </a>
                                                                           </div>
                                                                    </div>
                                                                </td>
                                                            </tr>
                                                            }
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div class="row justify-content-md-end align-items-md-center mt-3">
                                                    <!-- Pagination -->
                                                    <div class="col col-sm-6">
                                                        <div class="text-sm-right float-sm-end listjs-pagination">
                            
                                                            <ngb-pagination [collectionSize]="allinvoices?.length" [(page)]="service.page"
                                                                [pageSize]="service.pageSize" (pageChange)="changePage()">
                                                            </ngb-pagination>
                                                        </div>
                                                    </div>
                                                    <!-- End Pagination -->
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div id="elmLoader">
                                        <div class="spinner-border text-primary avatar-sm" role="status">
                                            <span class="visually-hidden">Loading...</span>
                                        </div>
                                    </div>
                                </div>
                                <!--end col-->
                            </div>
                        </div>
                    </div> <!-- .card-->
                </div> <!-- .col-->

            </div>
           

        </div> <!-- end .h-100-->

    </div> <!-- end col -->

   
</div>

<app-toasts aria-live="polite" aria-atomic="true"></app-toasts>